<?php
 namespace App\Policies; use App\Models\Employee; use App\Models\User; use Illuminate\Auth\Access\HandlesAuthorization; use Illuminate\Auth\Access\Response; class EmployeePolicy { use HandlesAuthorization; public function viewAny(User $user): bool { return $user->hasAnyRole(['org-admin-l2', 'org-admin-l3']); } public function view(User $user, Employee $employees): bool { $userEmployeeProfile = $user->employee; if (!$userEmployeeProfile) return false; if ($user->hasRole('org-admin-l2')) { $adminOrg = $userEmployeeProfile->organization; $targetOrg = $employees->organization; return $adminOrg && $targetOrg && $adminOrg->isAncestorOf($targetOrg); } if ($user->hasRole('org-admin-l3')) { return $userEmployeeProfile->organization_id === $employees->organization_id; } if ($user->hasRole('user')) { return $user->id === $employees->user_id; } return false; } public function create(User $user): bool { return $user->hasAnyRole(['org-admin-l2', 'org-admin-l3']); } public function update(User $user, Employee $employees): bool { return $this->view($user, $employees); } public function delete(User $user, Employee $employees): bool { if ($user->hasRole('user')) { return false; } return $this->view($user, $employees); } public function restore(User $user, Employee $employees): bool { return false; } public function forceDelete(User $user, Employee $employees): bool { if ($user->hasRole('user')) { return false; } return $this->view($user, $employees); } } 